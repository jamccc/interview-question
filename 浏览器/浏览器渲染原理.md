## 解析HTML构建DOM树

当我们打开一个网页时，浏览器会去请求HTML文件，在网络传输中，传输的的内容都是0和1这样的字节数据，当浏览器接收到这些字节数据后悔转化成字符串。接下来浏览器会将这些字符串转化为token（标记），此过程叫做标记化，标记化结束后，会将这些标记转化成node，最后，这些node会根据之间的联系转换成DOM树。（在此期间会进行CSS或JS之间的下载）

## 解析CSS文件构建CSSOM树

在这一过程是很消耗资源的，因为样式可以设置也可以继承。在这一过程，浏览器分析各个节点的样式是什么，之后构建递归CSSOM树。为了节约性能，我们尽量避免写过于具体的CSS选择器，对于HTML来说，也尽量少的添加无意义的标签，保证层级扁平。

## DOM树+ CSSOM树结合成渲染树

渲染树只会包含需要显示的节点和节点的样式信息，若设置display：none，就不会显示在渲染树中。

## 显示页面

渲染树构建完成之后，浏览器就会根据渲染树来进行布局（也可以叫做回流），然后调用CPU绘制，合成图层，显示在屏幕上。

## 为什么操作DOM慢

因为DOM属于渲染引擎的东西，JS属于JS引擎的东西，使用JS操作DOM，属于跨线程工作，需要在两个线程之间切换，浪费性能。并且操作DOM可能造成重绘或者回流，依旧影响性能。

## 插入几万个DOM如何保证页面不卡顿

1. requestAnimationFrame()方法循环的插入DOM 
2. 采用虚拟滚动的方式插入DOM，只渲染可视区域的内容，非可视区域的内容就完全不渲染了，当用户滚动时实时替换渲染内容。
  
## 什么情况阻塞渲染

1. 渲染的前提是生成渲染树，所以HTML,CSS肯定会阻塞渲染，所以一开始应该降低需要渲染的文件的带下，并且扁平层级，优化选择器。
2. 浏览器解析到script标签的时候，会停止构建DOM树，如果想首屏渲染速度快，就不要在首页加载JS 。
3. script标签添加defer属性，表示该文件会并行下载，但是会放到HTL解析完成后顺序执行
4. script标签添加async属性，表示JS文件下载和解析不会阻塞渲染。

## 重绘和回流

1. 重绘表示当前节点需要更改外观，而不影响布局。比如改变color
2. 回流是布局或几何属性改变。比如width，font-size
3. 回流一定发生重绘，重绘不一定发生回流。
4. 改变父节点内的子节点，很可能导致父节点一系列的回流。

## 导致性能问题的几个动作
  
1. 改变window的大小
2. 改变字体
3. 添加或删除样式
4. 文字改变
5. 定位或者浮动
6. 盒模型
  
## 减少重绘和回流

1. 使用transform代替top
2. 使用visibility代替display：none;
3. 不要把节点的属性放在循环中当做循环的变量
4. 不要使用table布局
5. 动画实现的速度的选择，动画越快，回流越多
6. css选择从右网左匹配查找，避免节点层级过多。
7. 将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点。
   
## 如何提高首页的渲染速度

1. 首页尽量加载小的文件
2. 尽量不加载script或者script标签添加async属性
3. 对于CSS采用层级扁平，尽量不适用过于具体的选择器
4. 虚拟滚动渲染，只渲染可是区域的内容，非可视区域的先不渲染。
5. 懒执行，对于在首页不需要计算的，可以等到使用它时在进行计算。




